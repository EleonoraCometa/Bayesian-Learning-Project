---
title: "Code"
output: html_document
date: "2024-08-10"
---

```{r}
# pyplot-like plots in R
library("ggplot2")
library("BAS")
```

Read data:

```{r}
data = read.csv("indprod.csv")
data$DATE = as.Date(data$DATE)
```

```{r}
g1 = ggplot(data=data, aes(x=as.Data(DATE),y=INDPRO_PCH))

# Plot dell'indice nel tempo
plot(as.Date(data$DATE), data$INDPRO_PCH, type="l", 
     col="black", lwd=1,
     xlab="Date", ylab="IPI Index", main="Time-Series of IPI")
```

```{r}
data_ = data[, -1]
model = lm(INDPRO_PCH ~ ., data = data_)
y_freq = predict(model)
coef(model)
```

# Frequenstistic Linear Regression

```{r}
ggplot(data = data, aes(x = DATE, y = INDPRO_PCH)) +
  geom_point(color = "steelblue") +
  geom_line(data = data, aes(x = DATE, y = y_hat, color = "first"),  lty = 1) +
  xlab("Date") + ylab("IPI") + 
  ggtitle("Regression Line")
```

# Bayesian Linear Regression

## Zelman's G-prior

```{r}
alphapar=10
data_no_date = data[, -1]
model_object = bas.lm(INDPRO_PCH ~ ., data =  data_no_date, prior="g-prior", alpha=alphapar, modelprior = Bernoulli(1), include.always = ~ ., n.models = 1)
beta = coef(model_object)
beta
```

```{r}
plot(beta, subset = 1:12, ask = F)
```

```{r}
credible_intervals = confint(beta)
plot(credible_intervals, main=paste("g-prior alpha=",alphapar))
```
```{r}
data_
```

```{r}
data_1 = data_[, -1]
beta_mean = beta$postmean

# Model 
y_hat =  beta_mean[1] + 
         beta_mean[2] *   data_$WILL5000PR_PCH + 
         beta_mean[3] *   data_$HSN1F_PCH + 
         beta_mean[4] *   data_$DCOILBRENTEU_PCH + 
         beta_mean[5] *   data_$CORESTICKM159SFRBATL_PCH + 
         beta_mean[6] *   data_$TOTALSA_PCH + 
         beta_mean[7] *   data_$CPIUFDSL_PCH + 
         beta_mean[8] *   data_$DEXJPUS_PCH + 
         beta_mean[9] *   data_$MICH_PCH + 
         beta_mean[10] *  data_$VIXCLS_PCH + 
         beta_mean[11] *  data_$PAYEMS_PCH + 
         beta_mean[12] *  data_$PPIACO_PCH
```


```{r}
out = confint(beta)[, 1:2]
beta_low = out[,1]
beta_up = out[,2]

y_low =  beta_low[1] + 
         beta_low[2] *   data_$WILL5000PR_PCH + 
         beta_low[3] *   data_$HSN1F_PCH + 
         beta_low[4] *   data_$DCOILBRENTEU_PCH + 
         beta_low[5] *   data_$CORESTICKM159SFRBATL_PCH + 
         beta_low[6] *   data_$TOTALSA_PCH + 
         beta_low[7] *   data_$CPIUFDSL_PCH + 
         beta_low[8] *   data_$DEXJPUS_PCH + 
         beta_low[9] *   data_$MICH_PCH + 
         beta_low[10] *  data_$VIXCLS_PCH + 
         beta_low[11] *  data_$PAYEMS_PCH + 
         beta_low[12] *  data_$PPIACO_PCH

y_up =   beta_up[1] + 
         beta_up[2] *   data_$WILL5000PR_PCH + 
         beta_up[3] *   data_$HSN1F_PCH + 
         beta_up[4] *   data_$DCOILBRENTEU_PCH + 
         beta_up[5] *   data_$CORESTICKM159SFRBATL_PCH + 
         beta_up[6] *   data_$TOTALSA_PCH + 
         beta_up[7] *   data_$CPIUFDSL_PCH + 
         beta_up[8] *   data_$DEXJPUS_PCH + 
         beta_up[9] *   data_$MICH_PCH + 
         beta_up[10] *  data_$VIXCLS_PCH + 
         beta_up[11] *  data_$PAYEMS_PCH + 
         beta_up[12] *  data_$PPIACO_PCH
```



```{r}
# Plot
plot1 = 
  ggplot(data = data, aes(x = DATE, y = INDPRO_PCH)) + 
  geom_point(color = "steelblue") + xlab("DATE") +
  geom_line(data = data, aes(x = DATE, y = y_hat, color = "first"),  lty = 1) +
  geom_line(data = data, aes(x = DATE, y = y_low, lty = "second")) +
  geom_line(data = data, aes(x = DATE, y = y_up,  lty = "third")) +
  scale_colour_manual(values="darkorange", labels="Posterior Mean", name="") +
  scale_linetype_manual(values = c(1, 2), labels = c("lower" , "upper"),
                        name = "95% C.I.")

plot1

y_fit = predict(model_object, newdata = data_1)$fit
plot2 = 
  ggplot(data = data, aes(x = DATE, y = INDPRO_PCH)) + 
  geom_point(color = "steelblue") + xlab("DATE") +
  geom_line(data = data, aes(x = DATE, y = y_fit, color = "first"),  lty = 1) +
  scale_colour_manual(values="darkorange", labels="Posterior Mean", name="") +
  scale_linetype_manual(values = c(1, 2), labels = c("lower" , "upper"),
                        name = "95% C.I.")

plot2
```
```{r}
predictions = predict(model_object, 
                      newdata = data_1,
                      se.fit = TRUE)
pred_intervals = confint(predictions, level = 0.95)
y_pred_low = pred_intervals[,1]
y_pred_up = pred_intervals[,2]

plot3 = 
  ggplot(data = data, aes(x = DATE, y = INDPRO_PCH)) + 
  geom_point(color = "steelblue") + xlab("DATE") +
  geom_line(data = data, aes(x = DATE, y = y_hat, color = "first"),  lty = 1) +
  geom_line(data = data, aes(x = DATE, y = y_pred_low, lty = "second")) +
  geom_line(data = data, aes(x = DATE, y = y_pred_up,  lty = "third")) +
  scale_colour_manual(values="darkorange", labels="Posterior Mean", name="") +
  scale_linetype_manual(values = c(1, 2), labels = c("lower" , "upper"),
                        name = "95% C.I.")
plot3
```

